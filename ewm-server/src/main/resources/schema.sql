DROP TABLE IF EXISTS USERS, CATEGORIES, LOCATIONS, EVENTS, COMPILATIONS, COMPILATION_EVENT, REQUESTS, COMMENTS CASCADE; 

CREATE TABLE IF NOT EXISTS USERS 
(
                         ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                         NAME VARCHAR,
                         EMAIL VARCHAR(50) NOT NULL,
 			 CONSTRAINT pk_user PRIMARY KEY (ID),
			 CONSTRAINT UQ_USER_EMAIL UNIQUE (EMAIL)
			
);

CREATE TABLE IF NOT EXISTS CATEGORIES 
(
                         ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                         NAME VARCHAR,
 			 CONSTRAINT pk_categories PRIMARY KEY (ID),
			 CONSTRAINT UQ_CATEGORY_NAME UNIQUE (NAME)

);

CREATE TABLE IF NOT EXISTS LOCATIONS
(
                         ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                         LAT float,
                         LON float,
 			 CONSTRAINT pk_location PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS EVENTS
(
                         ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                         ANNOTATION VARCHAR,                
                         CATEGORY_ID BIGINT REFERENCES CATEGORIES (ID) ON DELETE CASCADE,
                         CREATED_ON TIMESTAMP WITHOUT TIME ZONE,                
                         DESCRIPTION VARCHAR NOT NULL,
                         EVENT_DATE TIMESTAMP WITHOUT TIME ZONE,                
			 INITIATOR_ID BIGINT REFERENCES USERS (ID) ON DELETE CASCADE,
			 LOCATION_ID BIGINT REFERENCES LOCATIONS (ID) ON DELETE CASCADE,
			 PAID BOOLEAN,
			 PARTICIPANT_LIMIT INTEGER,
                         PUBLESHED_ON TIMESTAMP WITHOUT TIME ZONE,                
			 REQUEST_MODERATION BOOLEAN,
			 STATE VARCHAR,
			 TITLE VARCHAR,
 			 CONSTRAINT pk_event PRIMARY KEY (ID)
);



CREATE TABLE IF NOT EXISTS COMPILATIONS
(
                         ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                         PINNED BOOLEAN,
                         TITLE VARCHAR,
 			 CONSTRAINT pk_compilation PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS COMPILATION_EVENT
(
                         ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
			 COMPILATION_ID BIGINT REFERENCES COMPILATIONS (ID) ON DELETE CASCADE,
			 EVENT_ID BIGINT REFERENCES EVENTS (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS REQUESTS 
(
                         ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                         CREATED TIMESTAMP WITHOUT TIME ZONE,                
			 EVENT_ID BIGINT REFERENCES EVENTS (ID) ON DELETE CASCADE,
			 REQUESTER_ID BIGINT REFERENCES USERS (ID) ON DELETE CASCADE,
                         STATUS VARCHAR(250) NOT NULL,
                         PRIMARY KEY (ID)                       		
);

CREATE TABLE IF NOT EXISTS COMMENTS
(
                         ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
			 AUTHOR_ID BIGINT REFERENCES USERS (ID) ON DELETE CASCADE,
			 EVENT_ID BIGINT REFERENCES EVENTS (ID) ON DELETE CASCADE,
                         TEXT VARCHAR NOT NULL,
                         CREATED TIMESTAMP WITHOUT TIME ZONE,                
			 MODIFIED BOOLEAN,
                         PRIMARY KEY (ID)                       		
);

